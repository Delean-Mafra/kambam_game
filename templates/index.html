<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban EV - Simulador Educacional</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- ===================================================================================
         CABE√áALHO
         =================================================================================== -->
    <header class="header" role="banner">
        <div class="header-left">
            <h1>üè≠ Kanban EV</h1>
            <span class="subtitle">Simulador de Fluxo de Trabalho √Ågil</span>
        </div>
        <div class="header-center">
            <div class="day-info">
                <span class="day-label">Dia</span>
                <span class="day-value" id="currentDay">0</span>
            </div>
            <button id="btnNextDay" class="btn btn-primary btn-large" aria-label="Avan√ßar para o pr√≥ximo dia">
                üé≤ Pr√≥ximo Dia
            </button>
        </div>
        <div class="header-right">
            <button id="btnRestart" class="btn btn-danger" aria-label="Reiniciar jogo">
                üîÑ Reiniciar
            </button>
            <button id="btnHelp" class="btn btn-secondary" aria-label="Abrir ajuda">
                ‚ùì Ajuda
            </button>
        </div>
    </header>

    <!-- ===================================================================================
         √ÅREA PRINCIPAL
         =================================================================================== -->
    <main class="main-container" role="main">
        <!-- Quadro Kanban -->
        <section class="kanban-board" aria-label="Quadro Kanban">
            <!-- Coluna: Backlog -->
            <div class="kanban-column" data-column="backlog">
                <div class="column-header">
                    <h2>üìã Backlog</h2>
                    <span class="card-count">0</span>
                </div>
                <div class="cards-container" id="backlog" 
                     role="listbox" 
                     aria-label="Cart√µes no Backlog"
                     tabindex="0"></div>
            </div>

            <!-- Coluna: Pronto para Iniciar -->
            <div class="kanban-column" data-column="ready">
                <div class="column-header">
                    <h2>üéØ Pronto</h2>
                    <div class="wip-indicator">
                        <span class="card-count">0</span>
                        <span class="wip-limit">/ 3</span>
                    </div>
                </div>
                <div class="wip-bar" data-wip-limit="3"></div>
                <div class="cards-container" id="ready"
                     role="listbox"
                     aria-label="Cart√µes prontos para iniciar"
                     tabindex="0"></div>
            </div>

            <!-- Coluna: An√°lise -->
            <div class="kanban-column" data-column="analysis">
                <div class="column-header">
                    <h2>üîç An√°lise</h2>
                    <div class="wip-indicator">
                        <span class="card-count">0</span>
                        <span class="wip-limit">/ 3</span>
                    </div>
                </div>
                <div class="wip-bar" data-wip-limit="3"></div>
                <div class="agent-slot analyst" data-agent-type="analyst">
                    <span class="agent-icon">üë§</span>
                    <span class="agent-name">Analista</span>
                    <span class="agent-dice" id="analystDice">-</span>
                </div>
                <div class="cards-container" id="analysis"
                     role="listbox"
                     aria-label="Cart√µes em an√°lise"
                     tabindex="0"></div>
            </div>

            <!-- Coluna: Desenvolvimento -->
            <div class="kanban-column" data-column="development">
                <div class="column-header">
                    <h2>üíª Desenvolvimento</h2>
                    <div class="wip-indicator">
                        <span class="card-count">0</span>
                        <span class="wip-limit">/ 4</span>
                    </div>
                </div>
                <div class="wip-bar" data-wip-limit="4"></div>
                <div class="agent-slot developer" data-agent-type="developer">
                    <span class="agent-icon">üë§</span>
                    <span class="agent-name">Desenvolvedor</span>
                    <span class="agent-dice" id="developerDice">-</span>
                </div>
                <div class="cards-container" id="development"
                     role="listbox"
                     aria-label="Cart√µes em desenvolvimento"
                     tabindex="0"></div>
            </div>

            <!-- Coluna: Teste -->
            <div class="kanban-column" data-column="testing">
                <div class="column-header">
                    <h2>üß™ Teste</h2>
                    <div class="wip-indicator">
                        <span class="card-count">0</span>
                        <span class="wip-limit">/ 3</span>
                    </div>
                </div>
                <div class="wip-bar" data-wip-limit="3"></div>
                <div class="agent-slot tester" data-agent-type="tester">
                    <span class="agent-icon">üë§</span>
                    <span class="agent-name">Testador</span>
                    <span class="agent-dice" id="testerDice">-</span>
                </div>
                <div class="cards-container" id="testing"
                     role="listbox"
                     aria-label="Cart√µes em teste"
                     tabindex="0"></div>
            </div>

            <!-- Coluna: Conclu√≠do -->
            <div class="kanban-column completed" data-column="deployed">
                <div class="column-header">
                    <h2>‚úÖ Conclu√≠do</h2>
                    <span class="card-count">0</span>
                </div>
                <div class="cards-container" id="deployed"
                     role="listbox"
                     aria-label="Cart√µes conclu√≠dos"
                     tabindex="0"></div>
            </div>
        </section>

        <!-- Painel Lateral -->
        <aside class="sidebar" role="complementary" aria-label="Painel de controle">
            <!-- Estat√≠sticas -->
            <div class="panel stats-panel">
                <h3>üìä Estat√≠sticas</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Valor Entregue</span>
                        <span class="stat-value positive" id="totalValue">R$ 0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Custo Acumulado</span>
                        <span class="stat-value negative" id="totalCost">R$ 0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Lucro</span>
                        <span class="stat-value" id="profit">R$ 0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Lead Time M√©dio</span>
                        <span class="stat-value" id="avgLeadTime">0 dias</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Throughput</span>
                        <span class="stat-value" id="throughput">0 / dia</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Bloqueios</span>
                        <span class="stat-value warning" id="blockedCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Equipe -->
            <div class="panel team-panel">
                <h3>üë• Equipe</h3>
                <div class="team-members">
                    <div class="team-member analyst" id="teamAnalyst">
                        <div class="member-header">
                            <span class="member-icon">üîç</span>
                            <span class="member-name">Analista</span>
                        </div>
                        <div class="member-stats">
                            <div class="stat">
                                <span>Efici√™ncia:</span>
                                <span class="efficiency">2x</span>
                            </div>
                            <div class="stat">
                                <span>√öltimo dado:</span>
                                <span class="last-dice">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="team-member developer" id="teamDeveloper">
                        <div class="member-header">
                            <span class="member-icon">üíª</span>
                            <span class="member-name">Desenvolvedor</span>
                        </div>
                        <div class="member-stats">
                            <div class="stat">
                                <span>Efici√™ncia:</span>
                                <span class="efficiency">2x</span>
                            </div>
                            <div class="stat">
                                <span>√öltimo dado:</span>
                                <span class="last-dice">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="team-member tester" id="teamTester">
                        <div class="member-header">
                            <span class="member-icon">üß™</span>
                            <span class="member-name">Testador</span>
                        </div>
                        <div class="member-stats">
                            <div class="stat">
                                <span>Efici√™ncia:</span>
                                <span class="efficiency">2x</span>
                            </div>
                            <div class="stat">
                                <span>√öltimo dado:</span>
                                <span class="last-dice">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico -->
            <div class="panel history-panel">
                <h3>üìú Hist√≥rico</h3>
                <div class="history-list" id="historyList" role="log" aria-live="polite">
                    <p class="history-empty">Nenhuma a√ß√£o ainda...</p>
                </div>
            </div>

            <!-- A√ß√µes -->
            <div class="panel actions-panel">
                <h3>‚ö° A√ß√µes</h3>
                <div class="actions-buttons">
                    <button id="btnAddCard" class="btn btn-success btn-block">
                        ‚ûï Adicionar Cart√£o
                    </button>
                    <button id="btnExportState" class="btn btn-secondary btn-block">
                        üì§ Exportar Estado
                    </button>
                    <button id="btnImportState" class="btn btn-secondary btn-block">
                        üì• Importar Estado
                    </button>
                </div>
            </div>
        </aside>
    </main>

    <!-- ===================================================================================
         √ÅREA DE GR√ÅFICOS
         =================================================================================== -->
    <section class="charts-section" aria-label="Gr√°ficos e m√©tricas">
        <div class="charts-grid">
            <div class="chart-container">
                <h3>üìà Diagrama de Fluxo Cumulativo (CFD)</h3>
                <canvas id="cfdChart" aria-label="Gr√°fico de fluxo cumulativo"></canvas>
            </div>
            <div class="chart-container">
                <h3>‚è±Ô∏è Lead Time por Cart√£o</h3>
                <canvas id="leadTimeChart" aria-label="Gr√°fico de lead time"></canvas>
            </div>
            <div class="chart-container">
                <h3>üí∞ Desempenho Financeiro</h3>
                <canvas id="financialChart" aria-label="Gr√°fico financeiro"></canvas>
            </div>
            <div class="chart-container">
                <h3>üìä Throughput por Dia</h3>
                <canvas id="throughputChart" aria-label="Gr√°fico de throughput"></canvas>
            </div>
        </div>
    </section>

    <!-- ===================================================================================
         RODAP√â
         =================================================================================== -->
    <footer class="footer" role="contentinfo">
        <div class="footer-left">
            <span class="legend-item">
                <span class="legend-color analyst"></span> Analista
            </span>
            <span class="legend-item">
                <span class="legend-color developer"></span> Desenvolvedor
            </span>
            <span class="legend-item">
                <span class="legend-color tester"></span> Testador
            </span>
        </div>
        <div class="footer-center">
            <p>Simulador educacional de metodologia Kanban</p>
        </div>
        <div class="footer-right">
            <span id="gameStatus">Aguardando in√≠cio...</span>
        </div>
    </footer>

    <!-- ===================================================================================
         MODAIS
         =================================================================================== -->
    
    <!-- Modal: Adicionar/Editar Cart√£o -->
    <div id="modalCard" class="modal" role="dialog" aria-labelledby="modalCardTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalCardTitle">Adicionar Cart√£o</h2>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </div>
            <form id="formCard" class="modal-body">
                <div class="form-group">
                    <label for="cardTitle">T√≠tulo *</label>
                    <input type="text" id="cardTitle" name="title" required 
                           placeholder="Ex: Implementar login" maxlength="50">
                </div>
                <div class="form-group">
                    <label for="cardDescription">Descri√ß√£o</label>
                    <textarea id="cardDescription" name="description" rows="3"
                              placeholder="Descri√ß√£o opcional da tarefa"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cardEffort">Esfor√ßo *</label>
                        <input type="number" id="cardEffort" name="effort" required
                               min="1" max="20" value="5">
                    </div>
                    <div class="form-group">
                        <label for="cardValue">Valor (R$) *</label>
                        <input type="number" id="cardValue" name="value" required
                               min="10" max="1000" value="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cardPriority">Prioridade</label>
                        <select id="cardPriority" name="priority">
                            <option value="low">Baixa</option>
                            <option value="medium" selected>M√©dia</option>
                            <option value="high">Alta</option>
                            <option value="urgent">Urgente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cardCategory">Categoria</label>
                        <select id="cardCategory" name="category">
                            <option value="feature">Feature</option>
                            <option value="bug">Bug</option>
                            <option value="improvement">Melhoria</option>
                            <option value="tech-debt">D√≠vida T√©cnica</option>
                        </select>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnCancelCard">Cancelar</button>
                <button type="submit" form="formCard" class="btn btn-primary">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Ajuda -->
    <div id="modalHelp" class="modal" role="dialog" aria-labelledby="modalHelpTitle" aria-hidden="true">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="modalHelpTitle">‚ùì Como Jogar</h2>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </div>
            <div class="modal-body help-content">
                <section>
                    <h3>üéØ Objetivo</h3>
                    <p>Gerencie o fluxo de trabalho de uma equipe de desenvolvimento para entregar o m√°ximo de valor poss√≠vel, respeitando os limites de WIP e minimizando o lead time.</p>
                </section>
                
                <section>
                    <h3>üé≤ Mec√¢nica do Jogo</h3>
                    <ul>
                        <li><strong>Pr√≥ximo Dia:</strong> A cada dia, dados s√£o rolados para cada membro da equipe (1-6). Este √© o trabalho que podem realizar.</li>
                        <li><strong>Especialistas:</strong> Cada membro dobra seu valor quando trabalha em sua √°rea de especializa√ß√£o.</li>
                        <li><strong>Custo Di√°rio:</strong> R$ 300 por dia de opera√ß√£o.</li>
                    </ul>
                </section>
                
                <section>
                    <h3>üìã Colunas do Quadro</h3>
                    <ul>
                        <li><strong>Backlog:</strong> Tarefas aguardando para serem iniciadas.</li>
                        <li><strong>Pronto:</strong> Tarefas prontas para serem puxadas.</li>
                        <li><strong>An√°lise:</strong> Tarefas sendo analisadas pelo Analista.</li>
                        <li><strong>Desenvolvimento:</strong> Tarefas sendo desenvolvidas.</li>
                        <li><strong>Teste:</strong> Tarefas sendo testadas.</li>
                        <li><strong>Conclu√≠do:</strong> Tarefas entregues que geram valor.</li>
                    </ul>
                </section>
                
                <section>
                    <h3>üö¶ Limites de WIP</h3>
                    <p>Cada coluna tem um limite m√°ximo de cart√µes. Quando atingido, novos cart√µes n√£o podem entrar at√© que espa√ßo seja liberado. Isso ajuda a identificar gargalos.</p>
                </section>
                
                <section>
                    <h3>üñ±Ô∏è Controles</h3>
                    <ul>
                        <li><strong>Arrastar:</strong> Mova cart√µes entre colunas (respeitando WIP).</li>
                        <li><strong>Pr√≥ximo Dia:</strong> Processa o trabalho do dia atual.</li>
                        <li><strong>Adicionar Cart√£o:</strong> Crie novos cart√µes no Backlog.</li>
                    </ul>
                </section>
                
                <section>
                    <h3>üìä M√©tricas</h3>
                    <ul>
                        <li><strong>Lead Time:</strong> Tempo desde "Pronto" at√© "Conclu√≠do".</li>
                        <li><strong>Throughput:</strong> Cart√µes entregues por dia.</li>
                        <li><strong>CFD:</strong> Visualiza√ß√£o do fluxo acumulado ao longo do tempo.</li>
                    </ul>
                </section>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary modal-close-btn">Entendi!</button>
            </div>
        </div>
    </div>

    <!-- Modal: Exportar/Importar -->
    <div id="modalExport" class="modal" role="dialog" aria-labelledby="modalExportTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalExportTitle">üì§ Exportar Estado</h2>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Copie o JSON abaixo para salvar o estado atual do jogo:</p>
                <textarea id="exportData" class="export-textarea" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close-btn">Fechar</button>
                <button type="button" class="btn btn-primary" id="btnCopyExport">Copiar</button>
            </div>
        </div>
    </div>

    <div id="modalImport" class="modal" role="dialog" aria-labelledby="modalImportTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalImportTitle">üì• Importar Estado</h2>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Cole o JSON exportado anteriormente:</p>
                <textarea id="importData" class="export-textarea" placeholder='{"day": 0, "cards": [...], ...}'></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close-btn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmImport">Importar</button>
            </div>
        </div>
    </div>

    <!-- Toast para notifica√ß√µes -->
    <div id="toastContainer" class="toast-container" aria-live="polite"></div>

    <!-- ===================================================================================
         SCRIPTS
         =================================================================================== -->
    <script src="{{ url_for('static', filename='js/rules.js') }}"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graphs.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>
